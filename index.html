<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overtime Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'primary': '#0D47A1',
              'primary-dark': '#0a3a82',
              'secondary': '#1E88E5',
              'accent': '#42A5F5',
              'light': '#F5F5F5',
              'dark': '#212121',
            }
          }
        }
      }
    </script>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "recharts": "https://aistudiocdn.com/recharts@^3.4.1"
  }
}
</script>
</head>
  <body class="bg-light dark:bg-dark">
    <div id="root"></div>
    <script type="module">
import React, { useState, useEffect, useCallback, useMemo, cloneElement, useRef } from 'https://aistudiocdn.com/react@^19.2.0';
import ReactDOM from 'https://aistudiocdn.com/react-dom@^19.2.0/client';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'https://aistudiocdn.com/recharts@^3.4.1';

// --- From constants.ts ---
const LOCATION_COLOR_PALETTE = [
  'bg-blue-200 text-blue-800 dark:bg-blue-700 dark:text-blue-100',
  'bg-green-200 text-green-800 dark:bg-green-700 dark:text-green-100',
  'bg-yellow-200 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100',
  'bg-purple-200 text-purple-800 dark:bg-purple-700 dark:text-purple-100',
  'bg-pink-200 text-pink-800 dark:bg-pink-700 dark:text-pink-100',
  'bg-indigo-200 text-indigo-800 dark:bg-indigo-700 dark:text-indigo-100',
  'bg-red-200 text-red-800 dark:bg-red-700 dark:text-red-100',
  'bg-teal-200 text-teal-800 dark:bg-teal-700 dark:text-teal-100',
];
const DEFAULT_LOCATION_COLOR = 'bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200';

// --- From components/icons/Icons.tsx ---
const PlusIcon = (props) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 4.5v15m7.5-7.5h-15" })
  )
);
const ChartBarIcon = (props) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" })
    )
);
const CalendarIcon = (props) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h22.5" })
    )
);
const HomeIcon = (props) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M2.25 12l8.954-8.955a.75.75 0 011.06 0l8.955 8.955M3 13.5V21h6V15h6v6h6v-7.5M12 3v5.25" })
    )
);
const PencilIcon = (props) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" })
  )
);
const TrashIcon = (props) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.124-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.077-2.09.921-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" })
  )
);
const CogIcon = (props) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M10.343 3.94c.09-.542.56-1.007 1.11-1.226l.554-.221a6.75 6.75 0 013.692 0l.554.221c.55.219 1.02.684 1.11 1.226l.099.598a6.75 6.75 0 012.875 2.119l.444.405a1.125 1.125 0 010 1.592l-.444.405a6.75 6.75 0 01-2.875 2.119l-.099.598c-.09.542-.56 1.007-1.11 1.226l-.554.221a6.75 6.75 0 01-3.692 0l-.554-.221c-.55-.219-1.02-.684-1.11-1.226l-.099-.598a6.75 6.75 0 01-2.875-2.119l-.444-.405a1.125 1.125 0 010-1.592l.444.405a6.75 6.75 0 012.875-2.119l.099-.598z" }),
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M15 12a3 3 0 11-6 0 3 3 0 016 0z" })
    )
);
const DownloadIcon = (props) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" })
    )
);
const UploadIcon = (props) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" })
    )
);

// --- From hooks/useOvertimeData.ts ---
const ENTRIES_STORAGE_KEY = 'overtime_entries';
const LOCATIONS_STORAGE_KEY = 'overtime_locations';
const LOCATION_COLORS_STORAGE_KEY = 'overtime_location_colors';
const useOvertimeData = () => {
  const [entries, setEntries] = useState([]);
  const [locations, setLocations] = useState([]);
  const [locationColors, setLocationColors] = useState({});

  useEffect(() => {
    try {
      const storedEntries = localStorage.getItem(ENTRIES_STORAGE_KEY);
      if (storedEntries) setEntries(JSON.parse(storedEntries));
      const storedLocations = localStorage.getItem(LOCATIONS_STORAGE_KEY);
      if (storedLocations) setLocations(JSON.parse(storedLocations));
      const storedLocationColors = localStorage.getItem(LOCATION_COLORS_STORAGE_KEY);
      if (storedLocationColors) setLocationColors(JSON.parse(storedLocationColors));
    } catch (error) {
      console.error("Failed to load data from localStorage", error);
    }
  }, []);
  
  const saveData = useCallback((key, data) => {
    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (error) {
      console.error(`Failed to save ${key} to localStorage`, error);
    }
  }, []);

  const manageLocation = useCallback((location) => {
    if (!location || locations.includes(location)) return;
    
    const updatedLocations = [...locations, location];
    const colorIndex = locations.length % LOCATION_COLOR_PALETTE.length;
    const newColor = LOCATION_COLOR_PALETTE[colorIndex];
    const updatedColors = { ...locationColors, [location]: newColor };

    setLocations(updatedLocations);
    setLocationColors(updatedColors);
    saveData(LOCATIONS_STORAGE_KEY, updatedLocations);
    saveData(LOCATION_COLORS_STORAGE_KEY, updatedColors);
  }, [locations, locationColors, saveData]);

  const saveEntries = useCallback((newEntries) => {
    const sortedEntries = [...newEntries].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
    setEntries(sortedEntries);
    saveData(ENTRIES_STORAGE_KEY, sortedEntries);
  }, [saveData]);

  const addEntry = useCallback((newEntry) => {
    manageLocation(newEntry.location);
    const entryWithId = { ...newEntry, id: new Date().toISOString() };
    saveEntries([...entries, entryWithId]);
  }, [entries, saveEntries, manageLocation]);

  const updateEntry = useCallback((updatedEntry) => {
    manageLocation(updatedEntry.location);
    const newEntries = entries.map(entry => entry.id === updatedEntry.id ? updatedEntry : entry);
    saveEntries(newEntries);
  }, [entries, saveEntries, manageLocation]);

  const deleteEntry = useCallback((id) => {
    const confirmed = window.confirm("Sei sicuro di voler cancellare questa registrazione?");
    if(confirmed) {
        const newEntries = entries.filter(entry => entry.id !== id);
        saveEntries(newEntries);
    }
  }, [entries, saveEntries]);
  
  const importData = useCallback((data) => {
    if (data && Array.isArray(data.entries) && Array.isArray(data.locations) && typeof data.locationColors === 'object') {
      const sortedEntries = [...data.entries].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
      
      setEntries(sortedEntries);
      setLocations(data.locations);
      setLocationColors(data.locationColors);
      
      saveData(ENTRIES_STORAGE_KEY, sortedEntries);
      saveData(LOCATIONS_STORAGE_KEY, data.locations);
      saveData(LOCATION_COLORS_STORAGE_KEY, data.locationColors);
      
      return true;
    }
    return false;
  }, [saveData]);

  return { entries, locations, locationColors, addEntry, updateEntry, deleteEntry, importData };
};

// --- From components/SettingsView.tsx ---
const SettingsView = ({ allData, onImportData }) => {
  const fileInputRef = useRef(null);

  const handleExport = () => {
    try {
      const jsonString = `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(allData, null, 2))}`;
      const link = document.createElement("a");
      const date = new Date().toISOString().split('T')[0];
      link.href = jsonString;
      link.download = `overtime_tracker_backup_${date}.json`;
      link.click();
    } catch (error) {
      console.error("Error exporting data:", error);
      alert("Si è verificato un errore durante l'esportazione dei dati.");
    }
  };

  const handleImportClick = () => {
    fileInputRef.current?.click();
  };

  const handleFileChange = (event) => {
    const file = event.target.files?.[0];
    if (!file) return;

    if (file.type !== "application/json") {
      alert("Seleziona un file di backup JSON valido.");
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const text = e.target?.result;
        if (typeof text !== 'string') {
            throw new Error("File could not be read");
        }
        const data = JSON.parse(text);
        
        const confirmed = window.confirm("Sei sicuro? L'importazione sovrascriverà tutti i dati attuali. Questa azione è irreversibile.");
        if (confirmed) {
          const success = onImportData(data);
          if (success) {
            alert("Dati importati con successo! L'app verrà ricaricata.");
            window.location.reload();
          } else {
            alert("Il file di backup non è valido o è corrotto.");
          }
        }
      } catch (error) {
        console.error("Error importing data:", error);
        alert("Si è verificato un errore durante l'importazione. Il file potrebbe essere corrotto.");
      }
    };
    reader.readAsText(file);
    if(event.target) event.target.value = ''; 
  };

  return React.createElement('div', { className: "max-w-2xl mx-auto space-y-8" },
    React.createElement('div', { className: "text-center" },
      React.createElement('h2', { className: "text-2xl font-bold text-gray-800 dark:text-gray-200" }, "Impostazioni"),
      React.createElement('p', { className: "text-gray-500 dark:text-gray-400" }, "Gestisci i dati della tua applicazione.")
    ),
    React.createElement('div', { className: "bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md" },
      React.createElement('h3', { className: "text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200" }, "Backup e Ripristino"),
      React.createElement('div', { className: "space-y-4" },
        React.createElement('div', null,
          React.createElement('button', {
            onClick: handleExport,
            className: "w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-secondary hover:bg-accent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"
          },
            React.createElement(DownloadIcon, { className: "w-5 h-5 mr-2" }),
            "Esporta Dati"
          ),
          React.createElement('p', { className: "mt-2 text-sm text-gray-500 dark:text-gray-400" }, "Salva una copia di tutti i tuoi dati in un file JSON. Conservalo in un posto sicuro.")
        ),
        React.createElement('div', null,
          React.createElement('input', { type: "file", ref: fileInputRef, onChange: handleFileChange, className: "hidden", accept: ".json" }),
          React.createElement('button', {
            onClick: handleImportClick,
            className: "w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md shadow-sm text-dark dark:text-light bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
          },
            React.createElement(UploadIcon, { className: "w-5 h-5 mr-2" }),
            "Importa Dati"
          ),
          React.createElement('p', { className: "mt-2 text-sm text-gray-500 dark:text-gray-400" }, "Ripristina i dati da un file di backup. Attenzione: i dati attuali verranno sovrascritti.")
        )
      )
    )
  );
};


// --- From components/Dashboard.tsx ---
const Dashboard = ({ entries, onNavigate, onAddClick }) => {
  const formatDuration = (minutes) => {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return `${hours}h ${mins}m`;
  };
  
  const now = new Date();
  const startOfWeek = new Date(now);
  startOfWeek.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1));
  startOfWeek.setHours(0, 0, 0, 0);
  const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);

  const weeklyTotal = entries
    .filter(e => new Date(e.date) >= startOfWeek)
    .reduce((sum, e) => sum + e.duration, 0);
  const monthlyTotal = entries
    .filter(e => new Date(e.date) >= startOfMonth)
    .reduce((sum, e) => sum + e.duration, 0);

  return React.createElement('div', { className: "space-y-6" },
    React.createElement('div', { className: "text-center" },
      React.createElement('h2', { className: "text-2xl font-bold text-gray-800 dark:text-gray-200" }, "Riepilogo"),
      React.createElement('p', { className: "text-gray-500 dark:text-gray-400" }, "Le tue ore di straordinario a colpo d'occhio.")
    ),
    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
      React.createElement('div', { className: "bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md text-center" },
        React.createElement('h3', { className: "text-lg font-semibold text-gray-600 dark:text-gray-300" }, "Questa Settimana"),
        React.createElement('p', { className: "text-4xl font-bold text-primary dark:text-accent mt-2" }, formatDuration(weeklyTotal))
      ),
      React.createElement('div', { className: "bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md text-center" },
        React.createElement('h3', { className: "text-lg font-semibold text-gray-600 dark:text-gray-300" }, "Questo Mese"),
        React.createElement('p', { className: "text-4xl font-bold text-primary dark:text-accent mt-2" }, formatDuration(monthlyTotal))
      )
    ),
    React.createElement('div', { className: "text-center mt-8" },
      React.createElement('button', {
        onClick: onAddClick,
        className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"
      },
        React.createElement(PlusIcon, { className: "w-5 h-5 mr-2" }),
        "Aggiungi Straordinario"
      )
    )
  );
};

// --- From components/OvertimeForm.tsx ---
const OvertimeForm = ({ onSave, onCancel, existingEntry, locations }) => {
  const [date, setDate] = useState('');
  const [startTime, setStartTime] = useState('');
  const [endTime, setEndTime] = useState('');
  const [notes, setNotes] = useState('');
  const [location, setLocation] = useState('');
  const [error, setError] = useState('');

  useEffect(() => {
    if (existingEntry) {
      setDate(existingEntry.date);
      setStartTime(existingEntry.startTime);
      setEndTime(existingEntry.endTime);
      setNotes(existingEntry.notes);
      setLocation(existingEntry.location);
    } else {
      const now = new Date();
      setDate(now.toISOString().split('T')[0]);
    }
  }, [existingEntry]);

  const durationMinutes = useMemo(() => {
    if (!date || !startTime || !endTime) return 0;
    try {
      const startDate = new Date(`${date}T${startTime}`);
      const endDate = new Date(`${date}T${endTime}`);
      if (endDate <= startDate) {
        endDate.setDate(endDate.getDate() + 1);
      }
      const diff = endDate.getTime() - startDate.getTime();
      return Math.round(diff / (1000 * 60));
    } catch (e) {
      return 0;
    }
  }, [date, startTime, endTime]);

  const formatDuration = (minutes) => {
    if (minutes <= 0) return '0h 0m';
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return `${hours}h ${mins}m`;
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (durationMinutes <= 0) {
      setError('L\'orario di fine deve essere successivo a quello di inizio.');
      return;
    }
    if (!location.trim()) {
      setError('Il campo Sede è obbligatorio.');
      return;
    }
    setError('');

    const entryData = {
        date,
        startTime,
        endTime,
        notes,
        location: location.trim(),
        duration: durationMinutes,
    };

    if (existingEntry) {
      onSave({ ...existingEntry, ...entryData });
    } else {
      onSave(entryData);
    }
  };

  return React.createElement('div', { className: "max-w-lg mx-auto bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md" },
    React.createElement('h2', { className: "text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200" },
      existingEntry ? 'Modifica Straordinario' : 'Aggiungi Straordinario'
    ),
    React.createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
      React.createElement('div', null,
        React.createElement('label', { htmlFor: "date", className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, "Data"),
        React.createElement('input', { type: "date", id: "date", value: date, onChange: (e) => setDate(e.target.value), required: true, className: "mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" })
      ),
      React.createElement('div', { className: "grid grid-cols-2 gap-4" },
        React.createElement('div', null,
          React.createElement('label', { htmlFor: "startTime", className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, "Inizio"),
          React.createElement('input', { type: "time", id: "startTime", value: startTime, onChange: (e) => setStartTime(e.target.value), required: true, className: "mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" })
        ),
        React.createElement('div', null,
          React.createElement('label', { htmlFor: "endTime", className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, "Fine"),
          React.createElement('input', { type: "time", id: "endTime", value: endTime, onChange: (e) => setEndTime(e.target.value), required: true, className: "mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" })
        )
      ),
      React.createElement('div', { className: "text-center p-3 bg-gray-100 dark:bg-gray-700 rounded-md" },
        React.createElement('span', { className: "text-sm font-medium text-gray-600 dark:text-gray-300" }, "Durata: "),
        React.createElement('span', { className: "text-lg font-bold text-primary dark:text-accent" }, formatDuration(durationMinutes))
      ),
      error && React.createElement('p', { className: "text-sm text-red-500 text-center" }, error),
      React.createElement('div', null,
        React.createElement('label', { htmlFor: "notes", className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, "Note (es. attività)"),
        React.createElement('textarea', { id: "notes", rows: 3, value: notes, onChange: (e) => setNotes(e.target.value), className: "mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" })
      ),
      React.createElement('div', null,
        React.createElement('label', { htmlFor: "location", className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, "Sede"),
        React.createElement('input', { id: "location", list: "locations-list", value: location, onChange: (e) => setLocation(e.target.value), required: true, className: "mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary", placeholder: "Seleziona o inserisci una sede" }),
        React.createElement('datalist', { id: "locations-list" }, locations.map(loc => React.createElement('option', { key: loc, value: loc })))
      ),
      React.createElement('div', { className: "flex justify-end space-x-3 pt-2" },
        React.createElement('button', { type: "button", onClick: onCancel, className: "px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 dark:bg-gray-600 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500" }, "Annulla"),
        React.createElement('button', { type: "submit", className: "px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark" }, "Salva")
      )
    )
  );
};

// --- From components/HistoryList.tsx ---
const HistoryList = ({ entries, onEdit, onDelete, locations, locationColors }) => {
  const [filterDate, setFilterDate] = useState('');
  const [filterKeyword, setFilterKeyword] = useState('');
  const [filterLocation, setFilterLocation] = useState('');

  const formatDate = (dateString) => new Date(dateString).toLocaleDateString('it-IT', { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' });
  const formatDuration = (minutes) => {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return `${hours}h ${String(mins).padStart(2, '0')}m`;
  };

  const filteredEntries = useMemo(() => {
    return entries.filter(entry => {
      const dateMatch = !filterDate || entry.date === filterDate;
      const locationMatch = !filterLocation || entry.location === filterLocation;
      const keywordMatch = !filterKeyword || 
        entry.notes.toLowerCase().includes(filterKeyword.toLowerCase()) ||
        entry.location.toLowerCase().includes(filterKeyword.toLowerCase());
      return dateMatch && keywordMatch && locationMatch;
    });
  }, [entries, filterDate, filterKeyword, filterLocation]);

  return React.createElement('div', { className: "space-y-6" },
    React.createElement('div', { className: "bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md" },
      React.createElement('h3', { className: "text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200" }, "Filtra Storico"),
      React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
        React.createElement('input', { type: "date", value: filterDate, onChange: e => setFilterDate(e.target.value), className: "w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm" }),
        React.createElement('select', { value: filterLocation, onChange: e => setFilterLocation(e.target.value), className: "w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm" },
          React.createElement('option', { value: "" }, "Tutte le sedi"),
          locations.map(loc => React.createElement('option', { key: loc, value: loc }, loc))
        ),
        React.createElement('input', { type: "text", placeholder: "Cerca per parola chiave...", value: filterKeyword, onChange: e => setFilterKeyword(e.target.value), className: "w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm" })
      )
    ),
    React.createElement('div', { className: "space-y-4" },
      filteredEntries.length > 0 ? filteredEntries.map(entry => {
        const colorClass = locationColors[entry.location] || DEFAULT_LOCATION_COLOR;
        return React.createElement('div', { key: entry.id, className: "bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col md:flex-row md:items-center md:justify-between" },
          React.createElement('div', { className: "flex-grow" },
            React.createElement('div', { className: "flex justify-between items-start" },
              React.createElement('div', null,
                React.createElement('p', { className: "font-bold text-lg text-primary dark:text-accent" }, formatDate(entry.date)),
                React.createElement('p', { className: "text-sm text-gray-600 dark:text-gray-400" }, `${entry.startTime} - ${entry.endTime}`)
              ),
              React.createElement('div', { className: "text-right md:hidden" },
                React.createElement('p', { className: "font-bold text-xl text-gray-800 dark:text-gray-200" }, formatDuration(entry.duration)),
                React.createElement('span', { className: `px-2 py-1 text-xs font-semibold rounded-full ${colorClass}` }, entry.location)
              )
            ),
            React.createElement('p', { className: "mt-2 text-gray-700 dark:text-gray-300" }, entry.notes || 'Nessuna nota.')
          ),
          React.createElement('div', { className: "flex items-center mt-4 md:mt-0 md:ml-4" },
            React.createElement('div', { className: "hidden md:flex flex-col items-end mr-4" },
              React.createElement('p', { className: "font-bold text-xl text-gray-800 dark:text-gray-200" }, formatDuration(entry.duration)),
              React.createElement('span', { className: `px-2 py-1 text-xs font-semibold rounded-full ${colorClass}` }, entry.location)
            ),
            React.createElement('div', { className: "flex space-x-2" },
              React.createElement('button', { onClick: () => onEdit(entry), className: "p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-gray-700 rounded-full" }, React.createElement(PencilIcon, { className: "w-5 h-5" })),
              React.createElement('button', { onClick: () => onDelete(entry.id), className: "p-2 text-red-600 hover:bg-red-100 dark:hover:bg-gray-700 rounded-full" }, React.createElement(TrashIcon, { className: "w-5 h-5" }))
            )
          )
        )
      }) : React.createElement('div', { className: "text-center py-10" }, React.createElement('p', { className: "text-gray-500 dark:text-gray-400" }, "Nessuna registrazione trovata."))
    )
  );
};

// --- From components/StatsView.tsx ---
const StatsView = ({ entries }) => {
  const now = new Date();
  const currentMonth = now.getMonth();
  const currentYear = now.getFullYear();

  const monthlyData = useMemo(() => {
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const data = Array.from({ length: daysInMonth }, (_, i) => ({ day: i + 1, ore: 0 }));
    entries.forEach(entry => {
      const entryDate = new Date(entry.date);
      if (entryDate.getMonth() === currentMonth && entryDate.getFullYear() === currentYear) {
        data[entryDate.getDate() - 1].ore += entry.duration / 60;
      }
    });
    return data.map(d => ({ ...d, ore: parseFloat(d.ore.toFixed(2)) }));
  }, [entries, currentMonth, currentYear]);

  const annualData = useMemo(() => {
    const data = [{ name: 'Gen', ore: 0 }, { name: 'Feb', ore: 0 }, { name: 'Mar', ore: 0 }, { name: 'Apr', ore: 0 }, { name: 'Mag', ore: 0 }, { name: 'Giu', ore: 0 }, { name: 'Lug', ore: 0 }, { name: 'Ago', ore: 0 }, { name: 'Set', ore: 0 }, { name: 'Ott', ore: 0 }, { name: 'Nov', ore: 0 }, { name: 'Dic', ore: 0 }];
    entries.forEach(entry => {
      const entryDate = new Date(entry.date);
      if (entryDate.getFullYear() === currentYear) {
        data[entryDate.getMonth()].ore += entry.duration / 60;
      }
    });
    return data.map(d => ({ ...d, ore: parseFloat(d.ore.toFixed(2)) }));
  }, [entries, currentYear]);

  const CustomTooltip = ({ active, payload, label }) => {
    if (active && payload && payload.length) {
      return React.createElement('div', { className: "bg-white dark:bg-gray-800 p-2 border border-gray-300 dark:border-gray-600 rounded shadow-md" },
        React.createElement('p', { className: "label" }, `Giorno ${label} : ${payload[0].value} ore`)
      );
    }
    return null;
  };
    
  const CustomTooltipAnnual = ({ active, payload, label }) => {
    if (active && payload && payload.length) {
        return React.createElement('div', { className: "bg-white dark:bg-gray-800 p-2 border border-gray-300 dark:border-gray-600 rounded shadow-md" },
            React.createElement('p', { className: "label" }, `${label} : ${payload[0].value} ore`)
        );
    }
    return null;
  };

  return React.createElement('div', { className: "space-y-8" },
    React.createElement('div', { className: "bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md" },
      React.createElement('h3', { className: "text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200" }, `Riepilogo Mensile (${new Date().toLocaleString('it-IT', { month: 'long' })})`),
      React.createElement(ResponsiveContainer, { width: "100%", height: 300 },
        React.createElement(BarChart, { data: monthlyData, margin: { top: 5, right: 20, left: -10, bottom: 5 } },
          React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: "rgba(128, 128, 128, 0.3)" }),
          React.createElement(XAxis, { dataKey: "day", tick: { fill: 'currentColor', fontSize: 12 } }),
          React.createElement(YAxis, { unit: "h", tick: { fill: 'currentColor', fontSize: 12 } }),
          React.createElement(Tooltip, { content: React.createElement(CustomTooltip), cursor: { fill: 'rgba(66, 165, 245, 0.2)' } }),
          React.createElement(Bar, { dataKey: "ore", fill: "#42A5F5" })
        )
      )
    ),
    React.createElement('div', { className: "bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md" },
      React.createElement('h3', { className: "text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200" }, `Riepilogo Annuale (${currentYear})`),
        React.createElement(ResponsiveContainer, { width: "100%", height: 300 },
            React.createElement(BarChart, { data: annualData, margin: { top: 5, right: 20, left: -10, bottom: 5 } },
                React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: "rgba(128, 128, 128, 0.3)" }),
                React.createElement(XAxis, { dataKey: "name", tick: { fill: 'currentColor', fontSize: 12 } }),
                React.createElement(YAxis, { unit: "h", tick: { fill: 'currentColor', fontSize: 12 } }),
                React.createElement(Tooltip, { content: React.createElement(CustomTooltipAnnual), cursor: { fill: 'rgba(13, 71, 161, 0.2)' } }),
                React.createElement(Bar, { dataKey: "ore", fill: "#0D47A1" })
            )
        )
    )
  );
};

// --- From App.tsx ---
const App = () => {
  const { entries, locations, locationColors, addEntry, updateEntry, deleteEntry, importData } = useOvertimeData();
  const [currentView, setCurrentView] = useState('dashboard');
  const [editingEntry, setEditingEntry] = useState(null);

  useEffect(() => {
    const LAST_PROMPT_KEY = 'overtime_last_backup_prompt_month';
    try {
        const lastPromptMonth = localStorage.getItem(LAST_PROMPT_KEY);
        const currentMonth = new Date().getMonth().toString();
        if (lastPromptMonth !== currentMonth) {
            setTimeout(() => {
                const confirmed = window.confirm("Promemoria: ti consigliamo di effettuare un backup dei tuoi dati regolarmente. Vuoi andare alla pagina delle impostazioni per esportarli ora?");
                if(confirmed) {
                    setCurrentView('settings');
                }
                localStorage.setItem(LAST_PROMPT_KEY, currentMonth);
            }, 1500);
        }
    } catch (error) {
        console.error("Failed to check backup reminder:", error);
    }
  }, []);

  const handleAddClick = () => {
    setEditingEntry(null);
    setCurrentView('form');
  };

  const handleEditClick = (entry) => {
    setEditingEntry(entry);
    setCurrentView('form');
  };

  const handleSave = (entry) => {
    if ('id' in entry) {
      updateEntry(entry);
    } else {
      addEntry(entry);
    }
    setEditingEntry(null);
    setCurrentView('history');
  };
  
  const renderView = () => {
    switch (currentView) {
      case 'dashboard':
        return React.createElement(Dashboard, { entries, onNavigate: setCurrentView, onAddClick: handleAddClick });
      case 'form':
        return React.createElement(OvertimeForm, { onSave: handleSave, onCancel: () => setCurrentView(editingEntry ? 'history' : 'dashboard'), existingEntry: editingEntry, locations });
      case 'history':
        return React.createElement(HistoryList, { entries, onEdit: handleEditClick, onDelete: deleteEntry, locations, locationColors });
      case 'stats':
        return React.createElement(StatsView, { entries });
      case 'settings':
        const allData = { entries, locations, locationColors };
        return React.createElement(SettingsView, { allData: allData, onImportData: importData });
      default:
        return React.createElement(Dashboard, { entries, onNavigate: setCurrentView, onAddClick: handleAddClick });
    }
  };

  const NavItem = ({ view, label, icon }) => (
    React.createElement('button', {
      onClick: () => setCurrentView(view),
      className: `flex flex-col items-center justify-center w-full pt-2 pb-1 text-xs transition-colors duration-200 ${currentView === view ? 'text-primary dark:text-accent' : 'text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-accent'}`
    },
      icon,
      React.createElement('span', { className: "mt-1" }, label)
    )
  );

  const DesktopNavItem = ({ view, label, icon }) => (
    React.createElement('button', {
      onClick: () => setCurrentView(view),
      className: `flex items-center w-full p-3 text-left text-base rounded-lg transition-colors duration-200 ${currentView === view ? 'bg-secondary text-white' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}`
    },
      cloneElement(icon, { className: "w-6 h-6 mr-3" }),
      React.createElement('span', null, label)
    )
  );

  return React.createElement('div', { className: "min-h-screen bg-light dark:bg-dark text-dark dark:text-light font-sans flex" },
    React.createElement('nav', { className: "hidden md:flex flex-col w-64 bg-white dark:bg-gray-800 shadow-lg flex-shrink-0" },
      React.createElement('div', { className: "bg-primary text-white p-4 flex items-center h-[68px]" },
        React.createElement('h1', { className: "text-xl font-bold" }, "Overtime Tracker Pro")
      ),
      React.createElement('div', { className: "flex flex-col p-4 space-y-2" },
        React.createElement(DesktopNavItem, { view: "dashboard", label: "Home", icon: React.createElement(HomeIcon, { className: "w-6 h-6" }) }),
        React.createElement(DesktopNavItem, { view: "history", label: "Storico", icon: React.createElement(CalendarIcon, { className: "w-6 h-6" }) }),
        React.createElement(DesktopNavItem, { view: "stats", label: "Statistiche", icon: React.createElement(ChartBarIcon, { className: "w-6 h-6" }) }),
        React.createElement(DesktopNavItem, { view: "settings", label: "Impostazioni", icon: React.createElement(CogIcon, { className: "w-6 h-6" }) })
      ),
      React.createElement('div', { className: "mt-auto p-4" },
        React.createElement('button', {
          onClick: handleAddClick,
          className: "w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary"
        },
          React.createElement(PlusIcon, { className: "w-5 h-5 mr-2" }),
          "Aggiungi Straordinario"
        )
      )
    ),
    React.createElement('div', { className: "flex-1 flex flex-col min-w-0" },
      React.createElement('header', { className: "md:hidden bg-primary text-white shadow-md p-4 flex justify-between items-center sticky top-0 z-10" },
        React.createElement('h1', { className: "text-xl font-bold" }, "Overtime Tracker Pro"),
        React.createElement('button', { onClick: handleAddClick, className: "bg-secondary hover:bg-accent text-white p-2 rounded-full shadow-lg" },
          React.createElement(PlusIcon, { className: "w-6 h-6" })
        )
      ),
      React.createElement('main', { className: "flex-grow p-4 md:p-6 mb-16 md:mb-0 overflow-y-auto" },
        renderView()
      )
    ),
    React.createElement('div', { className: "fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg md:hidden z-10" },
      React.createElement('div', { className: "flex justify-around items-center h-full" },
        React.createElement(NavItem, { view: "dashboard", label: "Home", icon: React.createElement(HomeIcon, { className: "w-6 h-6" }) }),
        React.createElement(NavItem, { view: "history", label: "Storico", icon: React.createElement(CalendarIcon, { className: "w-6 h-6" }) }),
        React.createElement(NavItem, { view: "stats", label: "Statistiche", icon: React.createElement(ChartBarIcon, { className: "w-6 h-6" }) }),
        React.createElement(NavItem, { view: "settings", label: "Impostazioni", icon: React.createElement(CogIcon, { className: "w-6 h-6" }) })
      )
    )
  );
};

// --- From index.tsx ---
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}
const root = ReactDOM.createRoot(rootElement);
root.render(
  React.createElement(React.StrictMode, null, React.createElement(App))
);

    </script>
  </body>
</html>
